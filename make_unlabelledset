import cv2
import os
import numpy as np

def extract_random_frames_from_videos(video_folder, output_folder, num_images):
    video_files = [os.path.join(video_folder, f) for f in os.listdir(video_folder) if f.endswith(('.mp4', '.avi'))]

    total_frames = 0
    frame_counts = []
    for video_file in video_files:
        cap = cv2.VideoCapture(video_file)
        frame_count = int(cap.get(cv2.CAP_PROP_FRAME_COUNT))
        total_frames += frame_count
        frame_counts.append((cap, frame_count)) 


    random_frames = np.random.choice(range(total_frames), num_images, replace=False)
    random_frames.sort()
    

    current_frame_cumulative = 0
    for cap, frame_count in frame_counts:
        next_frame_cumulative = current_frame_cumulative + frame_count
        target_frames = [f for f in random_frames if current_frame_cumulative <= f < next_frame_cumulative]
        
        if target_frames:
            for target_frame in target_frames:
                frame_index = target_frame - current_frame_cumulative
                cap.set(cv2.CAP_PROP_POS_FRAMES, frame_index)
                ret, frame = cap.read()
                if ret:
                    cv2.imwrite(os.path.join(output_folder, f'frame_{target_frame}.png'), frame)
        
        current_frame_cumulative = next_frame_cumulative
        cap.release()

# Usage
video_folder = 'path_to_your_video_folder'
output_folder = 'output_frames_folder'
extract_random_frames_from_videos(video_folder, output_folder, 10)  # Extract 10 random frames
